<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
<link rel="icon" 
      type="image/png" 
      href="favicon.png">


<script src="FileSaver.js"></script>
<script type="text/javascript" > 
  var contexts = new Array();
  var version="0.1";
  var gameLink="www.flickgame.org"
  var canvasIndex=0;
  var canvasses = new Array();
  var scripts = new Array();

  var shareLinkInner=null;



//arne
  var colorPalette = [
           "#000000",
            "#9D9D9D",
            "#FFFFFF",
            "#BE2633",
            "#E06F8B",
            "#493C2B",
            "#A46422",
            "#EB8931",
            "#F7E26B",
            "#2F484E",
            "#44891A",
            "#A3CE27",
            "#1B2632",
            "#005784",
            "#31A2F2",
            "#B2DCEF"
            ];


//dawnbringer
//http://www.pixeljoint.com/forum/forum_posts.asp?TID=12795
  // var colorPalette = [
  //           "#140c1c",
  //           "#442434",
  //           "#30346d",
  //           "#4e4a4e",
  //           "#854c30",
  //           "#346524",
  //           "#d04648",
  //           "#757161",
  //           "#597dce",
  //           "#d27d2c",
  //           "#8595a1",
  //           "#6daa2c",
  //           "#d2aa99",
  //           "#6dc2ca",
  //           "#dad45e",
  //           "#deeed6"
  //           ];

/*
//spectrum 
  var colorPalette = [
            "#000000",
            "#888888",
            "#CDCDCD",
            "#FFFFFF",
            "#0000CD",
            "#0000FF",
            "#CD0000",
            "#FF0000",
            "#CD00CD",
            "#FF00FF",
            "#00CD00",
            "#00FF00",
            "#00CDCD",
            "#00FFFF",
            "#CDCD00",
            "#FFFF00"
            ];
*/
  var colorElem = new Array();
    var layerElem = new Array();
  var colorIndex=getRandomInt(7,16);

var aurl = document.createElement('a');
function qualifyURL(url) {
  aurl.href = url;
  return aurl.href;
}


var radiusElem = new Array();
  var thumbnailCanvas = new Array();
  var thumbnailContext = new Array();
  var scriptTextArea = new Array();

var standalone_HTML_String="";

var clientStandaloneRequest = new XMLHttpRequest();

clientStandaloneRequest.open('GET', 'play3e.html');
clientStandaloneRequest.onreadystatechange = function() {

    if(clientStandaloneRequest.readyState!=4) {
      return;
    }
    standalone_HTML_String=clientStandaloneRequest.responseText;
}
clientStandaloneRequest.send();


var get_blob = function() {
    return self.Blob;
}

function buildStandalone(sourceCode) {
  if (standalone_HTML_String.length===0) {
    alert("Can't export yet - still downloading html template.",true);
    return;
  }
  sourceCode=encodeURI(sourceCode);
  var htmlString = standalone_HTML_String.concat("");


  htmlString = "<!--Save as html file-->\n"+htmlString;
  htmlString = htmlString.replace(/__EMBED__/g,sourceCode);

  var BB = get_blob();
  var blob = new BB([htmlString], {type: "text/plain;charset=utf-8"});
  saveAs(blob, "flickgame.html");
}

function exportClick(){
  var embedDat = stateToString();
  buildStandalone(embedDat);
}

function importClick(){
  var reader = new FileReader();

  reader.onload = function(e) {
   var text = reader.result;
  }

  reader.readAsText(file, encoding);
}



OAUTH_CLIENT_ID = "eb2aad12c63aec0136b1";


function getAuthURL(){
  var randomState = window.btoa(Array.prototype.map.call(
    window.crypto.getRandomValues(new Uint8Array(24)),
    function(x) { return String.fromCharCode(x); }).join(""));

  var authUrl = "https://github.com/login/oauth/authorize"
    + "?client_id=" + OAUTH_CLIENT_ID
    + "&scope=gist"
    + "&state=" + randomState
    + "&allow_signup=true";

  return authUrl;
}

function printUnauthorized(){

  var authUrl = getAuthURL();
  var toPrint = "<a target=\"_blank\" href=\"" + authUrl + "\">Log in with Github to share</a><br>";

    var shareLink = document.getElementById("shareLink");
    shareLink.innerHTML = toPrint;
    shareLinkInner=null;
}



function githubLogOut(){
  window.localStorage.removeItem("oauth_access_token");
  var authUrl = getAuthURL();
  var toPrint = "Logged out of Github.<br>";
  var shareLink = document.getElementById("shareLink");
  shareLink.innerHTML = toPrint;
  shareLinkInner=null;
}


function shareClick() {
  var oauthAccessToken = window.localStorage.getItem("oauth_access_token");
  if (typeof oauthAccessToken !== "string") {
    // Generates 32 letters of random data, like "liVsr/e+luK9tC02fUob75zEKaL4VpQn".
    printUnauthorized();
    return;
  }


  var str = stateToString();

  var gistToCreate = {
    "description" : "flickgame",
    "public" : true,
    "files": {
      "readme.txt" : {
        "content": "A game made with www.flickgame.org.  You can import game.txt there to play the game.  Uh, too lazy to describe - HMU at analytic@gmail.com if you want to know how (basically just use the gist ID in the url like other flickgames do...) "
      },
      "game.txt" : {
        "content": str
      }
    }
  };

  var githubURL = 'https://api.github.com/gists?access_token=' + oauthAccessToken;
  var githubHTTPClient = new XMLHttpRequest();
  githubHTTPClient.open('POST', githubURL);
  githubHTTPClient.onreadystatechange = function() {    
    var errorCount=0;
    if(githubHTTPClient.readyState!=4) {
      return;
    }   
    var result = JSON.parse(githubHTTPClient.responseText);
    if (githubHTTPClient.status===403) {
      errorCount++;
      alert(result.message);
    } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {

      if (githubHTTPClient.statusText==="Unauthorized"){      
        alert("Authorization check failed.  You have to log back into GitHub (or give it permission again or something).");
        window.localStorage.removeItem("oauth_access_token");
      } else {
        alert("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.  statusText);
      }

      printUnauthorized();
    } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {
      errorCount++;
      alert("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
    } else {
      var id = result.id;
      var url = "play3e.html?p="+id;
      url=qualifyURL(url);

      var editurl = "editor.html?hack="+id;
      editurl=qualifyURL(editurl);
      var sourceCodeLink = "link to source code:<br><a href=\""+editurl+"\">"+editurl+"</a>";

      var shareLink = document.getElementById("shareLink");
      shareLink.innerHTML = "<a target=\"_blank\" href=\""+url+"\">&#8627;"+id+"</a><br>"+
        '(<a onclick="githubLogOut();"  href="javascript:void(0);">log out of GitHub</a>)<br>';
      shareLinkInner = shareLink.childNodes[0];

      if (errorCount>0) {
        alert("Cannot link directly to playable game, because there are errors.",true);
      } else {

      } 


    }
  }
  githubHTTPClient.setRequestHeader("Content-type","application/x-www-form-urlencoded");
  var stringifiedGist = JSON.stringify(gistToCreate);
  githubHTTPClient.send(stringifiedGist);
    lastDownTarget=canvas;  
}


function RLE_encode(input) {
    var encoding = [];
    var prev, count, i;
    for (count = 1, prev = input[0], i = 1; i < input.length; i++) {
        if (input[i] != prev) {
            encoding.push(count);
            encoding.push(prev);
            count = 1;
            prev = input[i];
        }
        else 
            count ++;
    }
    encoding.push(count);
    encoding.push(prev);
    return encoding;
}

function RLE_decode(encoded) {
    var output = "";
    encoded.forEach(function(pair){ output += new Array(1+pair[0]).join(pair[1]) })
    return output;
}

function stateToString(){
  var state = new Object();
  state.canvasIndex=canvasIndex;
  state.gameLink=gameLink;
  state.canvasses=new Array();
  for (var i=0;i<pages;i++){
    var canvas=canvasses[i];
    var s="";
    for (var j=0;j<width*height;j++){
      s+=canvas[j].toString(16);
    }
    var pairs=RLE_encode(s);    
    state.canvasses.push(pairs);
  }
  state.scripts=scripts;
  var result=JSON.stringify(state);
  return result;
}

function stringToState(str){
  var state = JSON.parse(str);
  gameLink=state.gameLink;
  canvasIndex=state.canvasIndex;
  canvasses=new Array();
  for (var k=0;k<state.canvasses.length;k++){
    var s = state.canvasses[k];
    var ar = new Uint8Array(width*height);
    var index=0;
    for (var i=0;i<s.length;i+=2){
      var count=s[i];
      var ch=s[i+1];
      for (var j=0;j<count;j++){
        ar[index]=parseInt(ch,16);
        index++;
      }
    }
    canvasses.push(ar);
  }

  scripts=state.scripts;


  setVisuals(true);
  setLayer(canvasIndex+1); 
}

document.addEventListener("keydown", press);

var copyImage = null;

var savedString;
function press(evt){
  evt = evt || window.event;

  if (evt.target.nodeName=="TEXTAREA"){
    return;
  }
  /*
  if (evt.keyCode==83){//S(ave)
    savedString = stateToString();
  } else if (evt.keyCode==76){//L(oad)
    stringToState(savedString);
    setVisuals();
    setLayer(canvasIndex+1); 
  } */
  if (evt.keyCode===67) { //c
    copyImage=JSON.stringify(canvasses[canvasIndex])
  } else if (evt.keyCode===86){ //v
    if (copyImage!==null){
      preserveUndoState();
      var ar = JSON.parse(copyImage);
      var arui8 = new Uint8Array(width*height);
      for (var i=0;i<width*height;i++){
        arui8[i]=ar[i];
      }
      canvasses[canvasIndex]=arui8;
      setVisuals();
    }
  } else if (evt.keyCode ===189 || evt.keyCode===173 ) {//-
    if (radius===3) {
      setRadius(1);
    } else if (radius===5) {
      setRadius(3);
    }else if (radius===7) {
      setRadius(5);
    }else if (radius===9) {
      setRadius(7);
    }else if (radius===11) {
      setRadius(9);
    }else if (radius===13) {
      setRadius(11);
    }else if (radius===16) { 
      setRadius(13);
    }
  } else if (evt.keyCode===187 || evt.keyCode===61){//+
    if (radius===0){
      setRadius(1);
    } else if (radius===1){
      setRadius(3);
    } else if (radius===3) {
      setRadius(5);
    } else if (radius===5) {
      setRadius(7);
    }else if (radius===7) {
      setRadius(9);
    }else if (radius===9) {
      setRadius(11);
    }else if (radius===11) {
      setRadius(13);
    }else if (radius===13) {
      setRadius(16);
    }
  } else if (evt.keyCode===90){//z
    if (undoList.length>0){
      var dat = undoList.pop();
      canvasses[dat.canvasIndex]=dat.canvasDat;
      setLayer(dat.canvasIndex+1);
      
      if (shareLinkInner!==null){
        shareLinkInner.style.color="gray";
      }
    }
  }
}
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min)) + min;
  }
  var thumbwidth=20;
  var thumbheight=10;
  var width=200;
  var height=100;
  var zoomFactor=4;
  var radius=5;
  var pages=100;

  var visibleCanvas;
  var visibleContext;
  var linkInput;
  var id;
  var id_d;

  var lastX=-1;
  var lastY=-1;

  var bucketElem;

  function linkChange(newLink){
    gameLink=newLink;
  }

function clearPalette(){
  preserveUndoState();
  var canvas=canvasses[canvasIndex];
  for (var i=0;i<width*height;i++){
    canvas[i]=0;
  }

  setVisuals();
}
    function setRadius(newRadius) {
        radius=newRadius;
        bucketElem.setAttribute("class","radius");
        for(var i=0;i<16;i++){
          if (radiusElem[i]!==null){
            radiusElem[i].setAttribute("class","radius");
          }
        }
        if (newRadius>0){
          radiusElem[newRadius-1].setAttribute("class","radius selected");
        } else {
          bucketElem.setAttribute("class","radius selected");
        }
    }


    function setColor(newColorIndex) {
      colorIndex=newColorIndex;
        for(var i=0;i<16;i++){
          if (colorElem[i]!==null){
            colorElem[i].setAttribute("class","unselected");
          }
        }
        colorElem[colorIndex].setAttribute("class","selected");
    }

    function setLayer(newCanvasIndex) {
      canvasIndex=newCanvasIndex-1;
        for(var i=0;i<pages;i++){
          if (layerElem[i]!==null){
            layerElem[i].setAttribute("class","layerItem");
          }
        }
        layerElem[canvasIndex].setAttribute("class","layerItem selectedItem");
        setVisuals();
        for(var i=0;i<16;i++){
          scriptTextArea[i].value=scripts[canvasIndex][i];
        }
    }

    function trace(s){
      window.console.log(s);
    }
    
    function onTextAreaChange(elem,i){
      var s = elem.value;
      scripts[canvasIndex][i]=s;
    }

    function init() {
      
      linkInput=document.getElementById("linkInput");
      linkInput.value=gameLink;

      
      radii = new Array();
      for (var i=0;i<16;i++){
        elem = document.getElementById("radius_"+(i+1));                
        radiusElem[i]=elem;
        
      }

      for (var i=0;i<pages;i++){
        elem = document.getElementById("thumbnail"+(i+1));        
        thumbnailCanvas[i]=elem;
        thumbnailContext[i]=elem.getContext("2d");
      }
      for (var i=0;i<16;i++){
        elem = document.getElementById("textarea_"+i);
        var fn = function(e,i2){
          return function(){
            return onTextAreaChange(e,i2);
          }
        }
        elem.oninput = fn(elem,i);
        elem.onpropertychange = fn(elem,i);
        scriptTextArea[i] = elem;        
      }

      for (var i=0;i<16;i++){
        elem = document.getElementById("color_"+(i));        
        elem.style.backgroundColor=colorPalette[i];
        colorElem[i]=elem;
      }

      for (var i=0;i<pages;i++){
        elem = document.getElementById("layerItem"+(i+1));        
        layerElem[i]=elem;
      }


      bucketElem=document.getElementById("bucket");


      for (var i=0;i<pages;i++){
        canvasses[i]=new Uint8Array(width*height);
      }

      for (var i=0;i<pages;i++){
        scripts[i] = ["","","","","","","","","","","","","","","",""];
      }

      visibleCanvas = document.getElementById("mainCanvas");
      visibleCanvas.addEventListener('mousedown', mouseDown,false);
      visibleCanvas.addEventListener('mouseup', mouseUp,false);
      visibleCanvas.addEventListener('mousemove', mouseMove,false);
      visibleCanvas.addEventListener('mouseout', mouseOut,false);

      var fileUploader = document.getElementById("my_file");
      fileUploader.addEventListener('change', readFile, false);

      window.addEventListener('mouseup', mouseUp,false);

      visibleContext = visibleCanvas.getContext("2d");
      visibleContext.imageSmoothingEnabled= false;
      id = visibleContext.createImageData(1,1); // only do this once per page
      id_d=id.data;
      setVisuals();
      setColor(colorIndex);


      getData();


    }

  function readFile(evt) {
    //Retrieve the first (and only!) File from the FileList object
    var f = evt.target.files[0]; 

    if (f) {
      var r = new FileReader();
      r.onload = function(e) { 
        var contents = e.target.result;
        var fromToken="<!--__EmbedBegin__-->";
        var endToken="<!--__EmbedEnd__-->";
        var fromIndex=contents.indexOf(fromToken);
        var endIndex=contents.indexOf(endToken);
        var ss1 = contents.substr(fromIndex+fromToken.length,endIndex-fromIndex-fromToken.length);
        var ss2=ss1.substr(ss1.indexOf("=")+2);
        var decoded = decodeURI(ss2);
        var decoded2 = decoded.substring(0, decoded.length - 3);
        stringToState(decoded2);
        setVisuals(true);
        setLayer(canvasIndex+1); 
      }
      r.readAsText(f);
    } else { 
      alert("Failed to load file");
    }
  }



  function getParameterByName(name) {
      name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
      var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
          results = regex.exec(location.search);
      return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }


  function strip_http(url) {
     url = url.replace(/^https?:\/\//,'');
     return url;
  }

function getFromLocalStorage(){

  if (window.localStorage){
    var s = localStorage.getItem("flickdeck_state");
    if (s!=null){
      stringToState(s);
    }
  }
}

  function getData(){ 
    var id = getParameterByName("p").replace(/[\\\/]/,"");
    if (id===null||id.length===0) {
      
      getFromLocalStorage();
      return;
    }

    var githubURL = 'https://api.github.com/gists/'+id;

    var githubHTTPClient = new XMLHttpRequest();
    githubHTTPClient.open('GET', githubURL);
    githubHTTPClient.onreadystatechange = function() {
      if(githubHTTPClient.readyState!=4) {
        return;
      }   
      var result = JSON.parse(githubHTTPClient.responseText);
      if (githubHTTPClient.status===403) {
        alert(result.message);
      } else if (githubHTTPClient.status!==200&&githubHTTPClient.status!==201) {
        alert("HTTP Error "+ githubHTTPClient.status + ' - ' + githubHTTPClient.statusText);
      }
      var result = JSON.parse(githubHTTPClient.responseText);
      var code=result["files"]["game.txt"]["content"];
      
      stringToState(code);
      setVisuals(true);
      setLayer(canvasIndex+1); 
    }
    githubHTTPClient.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    githubHTTPClient.send();
  }


    function drawThumbnail(n){
      thumbCtx=thumbnailContext[n];
      thumbCtx.canvas.width=thumbwidth;
      thumbCtx.canvas.height=thumbheight;
      thumbCtx.width=thumbwidth;
      thumbCtx.height=thumbheight;
      thumbCtx.fillStyle="#FF0000";
      thumbCtx.fillRect(0,0,thumbwidth,thumbheight);
      var canvas=canvasses[n];
      var mag=width/thumbwidth;
      for (var i=0;i<thumbwidth;i++){
        for (var j=0;j<thumbheight;j++){
          var max=0;
          for (var i2=0;i2<mag;i2++){              
            for (var j2=0;j2<mag;j2++){
                var sample = canvas[i*mag+i2+width*(j*mag+j2)];
                if (sample>max){
                  max=sample;
                }
            }
          }
          thumbCtx.fillStyle=colorPalette[max];
          thumbCtx.fillRect(i,j,1,1);          
        }
      }

//      var dataUrl = thumbnailCanvas[n].toDataURL();
//      "dropdownOption"[0][0].style.backgroundImage="url("+dataUrl+")";
    }

    function setVisuals(genAllThumbnails){
      //visibleContext.drawImage(canvasses[canvasIndex], 0, 0); 
      //visibleContext.drawImage(canvasses[canvasIndex], 0, 0,width*zoomFactor,height*zoomFactor); 
      canvas=canvasses[canvasIndex];
      for (var i=0;i<width;i++){
        for (var j=0;j<height;j++){
          var pixelIndex = canvas[i+width*j]; 
          visibleContext.fillStyle=colorPalette[pixelIndex];
          visibleContext.fillRect(i*zoomFactor,j*zoomFactor,zoomFactor,zoomFactor);        
        }
      }
      if (genAllThumbnails===true){
        for (var i=0;i<pages;i++){
          drawThumbnail(i);          
        }
      } else {
        drawThumbnail(canvasIndex);
      }
      linkInput.value=gameLink;
    }


  var drawing=0;


  function getCoords(e) {
    var x,y; 
    if(typeof e.offsetX !== "undefined") {
        x = e.offsetX;
        y = e.offsetY;
    }
    else {      
      var target = e.target || e.srcElement;
      var rect = target.getBoundingClientRect();
      x = e.clientX - rect.left,
      y = e.clientY - rect.top;
    } 
    return [x,y];
  }

  function uint8ar_copy(src)  {
      var dst = new Uint8Array(width*height);
      for (var i=0;i<src.length;i++){
        dst[i]=src[i];
      }
      return dst;
  }

  function localStorageSave(){
    if (window.localStorage){
      localStorage.setItem("flickdeck_state",stateToString());
    }
  }

  var undoList=new Array();
  function preserveUndoState() {
    console.log("preserving undo state");
    localStorageSave();
    var undoItem = new Object();
    undoItem.canvasIndex=canvasIndex;
    undoItem.canvasDat=uint8ar_copy(canvasses[canvasIndex]);
    undoList.push(undoItem);
    if (undoList.length>30){
      undoList.shift();
    }

    if (shareLinkInner!==null){
      shareLinkInner.style.color="gray";
    }
  }

  function mouseDown(e){
    e = e || window.event;

    drawing=1;
    var coords = getCoords(e);
    startTargetX=coords[0];
    startTargetY=coords[1];
    lastX=Math.floor(startTargetX/zoomFactor);
    lastY=Math.floor(startTargetY/zoomFactor);
    
    preserveUndoState();
    mouseMove(e);
    if(radius===0){
      drawing=0;
    }
  }

  function mouseUp(e){
    e = e || window.event;

    drawing=0;
    lastX=-1;
    lastY=-1;
  }

  function mouseOut(e){
    e = e || window.event;

    mouseMove(e);
    lastX=-1;
    lastY=-1;
  }


  function line (x1, y1,x2,y2) {
    var coordinatesArray = new Array();
    // Translate coordinates
    // Define differences and error check
    var dx = Math.abs(x2 - x1);
    var dy = Math.abs(y2 - y1);
    var sx = (x1 < x2) ? 1 : -1;
    var sy = (y1 < y2) ? 1 : -1;
    var err = dx - dy;
    // Set first coordinates
    coordinatesArray.push([x1,y1]);
    // Main loop
    while (!((x1 == x2) && (y1 == y2))) {
      var e2 = err << 1;
      if (e2 > -dy) {
        err -= dy;
        x1 += sx;
      }
      if (e2 < dx) {
        err += dx;
        y1 += sy;
      }
      // Set coordinates
      coordinatesArray.push([x1,y1]);
    }
    // Return the result
    return coordinatesArray;
  }


  function mouseMove(e){
    e = e || window.event;

    if (drawing===0)
      return;

    var coords = getCoords(e);

    var x = Math.floor(coords[0]/zoomFactor);
    var y = Math.floor(coords[1]/zoomFactor);


    var canvas=canvasses[canvasIndex];

    var points;
    if (lastX===-1) {
      points=[[x,y]];
    } else {
      points=line(x,y,lastX,lastY);
    }

    for (var i=0;i<points.length;i++){
      var p=points[i];

      if (radius>0){
        drawCircle(canvas,p[0],p[1],radius,colorIndex);
      } else {
        floodFill(canvas, p[0], p[1], colorIndex);
      }
    }
  

    /*context.beginPath();
    context.arc(x, y, radius, 0, 2 * Math.PI, false);
    context.lineWidth = 0;
    context.fillStyle = 'green';
    context.fill();*/
    setVisuals();

    var coords = getCoords(e);
    lastX=Math.floor(coords[0]/zoomFactor);
    lastY=Math.floor(coords[1]/zoomFactor);
    
  }

  function drawCircle(canvas,x,y,radius,colorIndex){  
    radius=Math.floor(radius/2)+1;
    if (radius==2){
      var points = [[x,y],[x-1,y],[x,y+1],[x+1,y],[x,y-1]];
      for (var i=0;i<points.length;i++){
        var px=points[i][0];
        var py=points[i][1];
        if (px>=0&&px<width&&py>=0&&py<100){
          canvas[px+width*py]=colorIndex;
        }
      }
      return;
    } else if (radius==3){
      var points = [
                  [x-1,y+2],[x,y+2],[x+1,y+2],
        [x-2,y+1],[x-1,y+1],[x,y+1],[x+1,y+1],[x+2,y+1],
        [x-2,y  ],[x-1,y  ],[x,y  ],[x+1,y  ],[x+2,y  ],
        [x-2,y-1],[x-1,y-1],[x,y-1],[x+1,y-1],[x+2,y-1],
                  [x-1,y-2],[x,y-2],[x+1,y-2]
        ];
      for (var i=0;i<points.length;i++){
        var px=points[i][0];
        var py=points[i][1];
        if (px>=0&&px<width&&py>=0&&py<100){
          canvas[px+width*py]=colorIndex;
        }
      }
      return;

    }

    for (var i=Math.max(x-radius,0);i<=Math.min(x+radius,width-1);i++){
      for (var j=Math.max(y-radius,0);j<=Math.min(y+radius,height-1);j++){
        var dx = i-x;
        var dy = j-y;
        if ((dx*dx+dy*dy)<radius*radius){
          canvas[i+width*j]=colorIndex;          
        }
      }
    }  
  }

  function floodFill(canvas,x,y,colorIndex){
    var points = [[x,y]];
    originColor = canvas[x+width*y];
    if (originColor===colorIndex){
      return;
    }

    for (var i=0;i<points.length;i++){
      var p = points[i];
      var pIndex = p[0]+width*p[1];
      if (canvas[pIndex]===colorIndex) {
        continue;
      } else {
        canvas[pIndex]=colorIndex;
        borderPoints = [[p[0]+1,p[1]],[p[0]-1,p[1]],[p[0],p[1]+1],[p[0],p[1]-1]];
        for (var j=0;j<borderPoints.length;j++){
          var borderPoint=borderPoints[j]; 
          var bpx=borderPoint[0];
          var bpy=borderPoint[1];
          var bpi=bpx+width*bpy;
          if (
            bpx>=0 &&
            bpx<width &&
            bpy>=0 &&
            bpy<height &&
            canvas[bpi]===originColor){
            points.push([bpx,bpy]);
          }
        }
      }
    }
  }
</script>

    <style type="text/css">
/*<![CDATA[*/
#maincanvas {
  cursor:crosshair;
  margin:0;
  padding:0;
  image-rendering: optimizeSpeed;
  image-rendering: -moz-crisp-edges;
  image-rendering: -webkit-optimize-contrast;
  image-rendering: -o-crisp-edges;
  image-rendering: pixelated;
  -ms-interpolation-mode: nearest-neighbor;
}
#undertable {
  margin:0;
  padding:0;  
  /*border:2px solid gray; */
  border-top:none;
  width:800px;
}

body {
    -webkit-user-select: none; /* webkit (safari, chrome) browsers */
    -moz-user-select: none; /* mozilla browsers */
    -khtml-user-select: none; /* webkit (konqueror) browsers */
    -ms-user-select: none; /* IE10+ */ 
}
                 select {
                  background-color:black;
                  color:white;
                  text-indent:5px;
                 }
                canvas {
                  position:relative;
                }
                 body {
                  margin:0;
                  padding:0;
                 background-color:#202020;
                 color: gray;
                 margin-top: 0;
                 padding-top: 0;
                 border-top: 0;
                 }
                 input {
                 background-color: gray;
                 color:white;
                 font-size: 100%;
                 text-align: left;
                 margin-bottom: 0px;
                 }
                 textarea {
                  font-family:Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;

                  background-color: black;
                  color:white;
                  font-size: 60%;
                  text-align: left;
                  margin-bottom: 0px;
                  width:150px;
                  border-top: 0;
                  resize: none;
                  height:60px;
                  overflow:none ;
                  border: 1px solid gray;
                 }
                 input#titleinput {
                 background-color: black;
                 color:white;
                 font-size: 200%;
                 text-align: center;
                 margin-bottom: 5px;
                 }
                 input#linkInput {
                 background-color: black;
                 color:white;
                 font-size: 150%;
                 text-align: center;
                 margin-bottom: 5px;
                 padding-bottom:3px;
                 }
                 li {
                 font-size: 150%;                 
                  text-align: center;
                  width:100%;
                 }
                 a {
                  color:white;
                 }

                 .layerThumbnail {
                  border:2px solid gray; 
                  background-color:black;
                  width:30;
                  height:15;
                 }
                 ul {
                 list-style-type: none;
                 overflow:hidden; overflow-y:none;
                 padding:0;
                 margin:0;
                 margin-right:5px;
                 margin-left:5px;
                 }
                 a.layerItem{
                  color: white;
                  background-color: none;
                  text-decoration: none;
                  width:80px;
                  display:block;
                 }
                 a.layerItem.selectedItem{
                  color: black;
                  background-color: white;
                 }
                 img.selected {
                  border: 2px solid red;
                 }
                 li.selected  {
                 cursor:auto;
                 color:white;
                 }
                 a{
                  white-space:nowrap;
                }
                 div.selected {
                 height:60px; 
                 width:30px;
                 border: 2px solid red;
                 }
                 div.unselected {
                 height:60px; 
                 width:30px;
                 border: 2px solid black;
                 }
                 img.radius {
                  border: 1px solid black;
                 }
                 img.selected {
                  border: 1px solid red; 
                 }
                 select {
                 width:100%;
                 -webkit-appearance: none;
                 -moz-appearance: none;
                 }
                 select::-ms-expand {
                 display: none;
                 }
                 canvas#dropdownthumb {
                  border:2px solid gray; 
                  background-color:black;
                 }
    /*]]>*/
    </style>
    <title>
      flickdeck
    </title>
  </head>
  <body onload="init();" ondragstart="return false;" ondrop="return false;">
  <center>
    <table cellpadding="0">
      <tr>
        <td>          
          <ul>
            <li> 
              <a class="layerItem selectedItem" id="layerItem1" href="#" onclick="setLayer(1);return false;">
              <canvas id="thumbnail1" class="layerThumbnail"></canvas>
              1</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem2" href="#" onclick="setLayer(2);return false;">
              <canvas id="thumbnail2" class="layerThumbnail"></canvas>
              2</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem3" href="#" onclick="setLayer(3);return false;">
              <canvas id="thumbnail3" class="layerThumbnail"></canvas>
              3</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem4" href="#" onclick="setLayer(4);return false;">
              <canvas id="thumbnail4" class="layerThumbnail"></canvas>
              4</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem5" href="#" onclick="setLayer(5);return false;">
              <canvas id="thumbnail5" class="layerThumbnail"></canvas>
              5</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem6" href="#" onclick="setLayer(6);return false;">
              <canvas id="thumbnail6" class="layerThumbnail"></canvas>
              6</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem7" href="#" onclick="setLayer(7);return false;">
              <canvas id="thumbnail7" class="layerThumbnail"></canvas>
              7</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem8" href="#" onclick="setLayer(8);return false;">
              <canvas id="thumbnail8" class="layerThumbnail"></canvas>
              8</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem9" href="#" onclick="setLayer(9);return false;">
              <canvas id="thumbnail9" class="layerThumbnail"></canvas>
              9</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem10" href="#" onclick="setLayer(10);return false;">
              <canvas id="thumbnail10" class="layerThumbnail"></canvas>
              10</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem11" href="#" onclick="setLayer(11);return false;">
              <canvas id="thumbnail11" class="layerThumbnail"></canvas>
              11</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem12" href="#" onclick="setLayer(12);return false;">
              <canvas id="thumbnail12" class="layerThumbnail"></canvas>
              12</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem13" href="#" onclick="setLayer(13);return false;">
              <canvas id="thumbnail13" class="layerThumbnail"></canvas>
              13</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem14" href="#" onclick="setLayer(14);return false;">
              <canvas id="thumbnail14" class="layerThumbnail"></canvas>
              14</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem15" href="#" onclick="setLayer(15);return false;">
              <canvas id="thumbnail15" class="layerThumbnail"></canvas>
              15</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem16" href="#" onclick="setLayer(16);return false;">
              <canvas id="thumbnail16" class="layerThumbnail"></canvas>
              16</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem17" href="#" onclick="setLayer(17);return false;">
              <canvas id="thumbnail17" class="layerThumbnail"></canvas>
              17</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem18" href="#" onclick="setLayer(18);return false;">
              <canvas id="thumbnail18" class="layerThumbnail"></canvas>
              18</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem19" href="#" onclick="setLayer(19);return false;">
              <canvas id="thumbnail19" class="layerThumbnail"></canvas>
              19</a>
            </li>
            
            <li> 
              <a class="layerItem" id="layerItem20" href="#" onclick="setLayer(20);return false;">
              <canvas id="thumbnail20" class="layerThumbnail"></canvas>
              20</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem21" href="#" onclick="setLayer(21);return false;">
              <canvas id="thumbnail21" class="layerThumbnail"></canvas>
              21</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem22" href="#" onclick="setLayer(22);return false;">
              <canvas id="thumbnail22" class="layerThumbnail"></canvas>
              22</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem23" href="#" onclick="setLayer(23);return false;">
              <canvas id="thumbnail23" class="layerThumbnail"></canvas>
              23</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem24" href="#" onclick="setLayer(24);return false;">
              <canvas id="thumbnail24" class="layerThumbnail"></canvas>
              24</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem25" href="#" onclick="setLayer(25);return false;">
              <canvas id="thumbnail25" class="layerThumbnail"></canvas>
              25</a>
            </li>

          </ul>
        </td>
        <td>          
          <ul>
            
            <li> 
              <a class="layerItem" id="layerItem26" href="#" onclick="setLayer(26);return false;">
              <canvas id="thumbnail26" class="layerThumbnail"></canvas>
              26</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem27" href="#" onclick="setLayer(27);return false;">
              <canvas id="thumbnail27" class="layerThumbnail"></canvas>
              27</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem28" href="#" onclick="setLayer(28);return false;">
              <canvas id="thumbnail28" class="layerThumbnail"></canvas>
              28</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem29" href="#" onclick="setLayer(29);return false;">
              <canvas id="thumbnail29" class="layerThumbnail"></canvas>
              29</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem30" href="#" onclick="setLayer(30);return false;">
              <canvas id="thumbnail30" class="layerThumbnail"></canvas>
              30</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem31" href="#" onclick="setLayer(31);return false;">
              <canvas id="thumbnail31" class="layerThumbnail"></canvas>
              31</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem32" href="#" onclick="setLayer(32);return false;">
              <canvas id="thumbnail32" class="layerThumbnail"></canvas>
              32</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem33" href="#" onclick="setLayer(33);return false;">
              <canvas id="thumbnail33" class="layerThumbnail"></canvas>
              33</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem34" href="#" onclick="setLayer(34);return false;">
              <canvas id="thumbnail34" class="layerThumbnail"></canvas>
              34</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem35" href="#" onclick="setLayer(35);return false;">
              <canvas id="thumbnail35" class="layerThumbnail"></canvas>
              35</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem36" href="#" onclick="setLayer(36);return false;">
              <canvas id="thumbnail36" class="layerThumbnail"></canvas>
              36</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem37" href="#" onclick="setLayer(37);return false;">
              <canvas id="thumbnail37" class="layerThumbnail"></canvas>
              37</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem38" href="#" onclick="setLayer(38);return false;">
              <canvas id="thumbnail38" class="layerThumbnail"></canvas>
              38</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem39" href="#" onclick="setLayer(39);return false;">
              <canvas id="thumbnail39" class="layerThumbnail"></canvas>
              39</a>
            </li>
            
            <li> 
              <a class="layerItem" id="layerItem40" href="#" onclick="setLayer(40);return false;">
              <canvas id="thumbnail40" class="layerThumbnail"></canvas>
              40</a>
            </li>

            <li> 
              <a class="layerItem" id="layerItem41" href="#" onclick="setLayer(41);return false;">
              <canvas id="thumbnail41" class="layerThumbnail"></canvas>
              41</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem42" href="#" onclick="setLayer(42);return false;">
              <canvas id="thumbnail42" class="layerThumbnail"></canvas>
              42</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem43" href="#" onclick="setLayer(43);return false;">
              <canvas id="thumbnail43" class="layerThumbnail"></canvas>
              43</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem44" href="#" onclick="setLayer(44);return false;">
              <canvas id="thumbnail44" class="layerThumbnail"></canvas>
              44</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem45" href="#" onclick="setLayer(45);return false;">
              <canvas id="thumbnail45" class="layerThumbnail"></canvas>
              45</a>
            </li>


            <li> 
              <a class="layerItem" id="layerItem46" href="#" onclick="setLayer(46);return false;">
              <canvas id="thumbnail46" class="layerThumbnail"></canvas>
              46</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem47" href="#" onclick="setLayer(47);return false;">
              <canvas id="thumbnail47" class="layerThumbnail"></canvas>
              47</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem48" href="#" onclick="setLayer(48);return false;">
              <canvas id="thumbnail48" class="layerThumbnail"></canvas>
              48</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem49" href="#" onclick="setLayer(49);return false;">
              <canvas id="thumbnail49" class="layerThumbnail"></canvas>
              49</a>
            </li>
            
            <li> 
              <a class="layerItem" id="layerItem50" href="#" onclick="setLayer(50);return false;">
              <canvas id="thumbnail50" class="layerThumbnail"></canvas>
              50</a>
            </li>

          </ul>
        </td>
       

        <td>          
          <ul>
            <li> 
              <a class="layerItem" id="layerItem51" href="#" onclick="setLayer(51);return false;">
              <canvas id="thumbnail51" class="layerThumbnail"></canvas>
              51</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem52" href="#" onclick="setLayer(52);return false;">
              <canvas id="thumbnail52" class="layerThumbnail"></canvas>
              52</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem53" href="#" onclick="setLayer(53);return false;">
              <canvas id="thumbnail53" class="layerThumbnail"></canvas>
              53</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem54" href="#" onclick="setLayer(54);return false;">
              <canvas id="thumbnail54" class="layerThumbnail"></canvas>
              54</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem55" href="#" onclick="setLayer(55);return false;">
              <canvas id="thumbnail55" class="layerThumbnail"></canvas>
              55</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem56" href="#" onclick="setLayer(56);return false;">
              <canvas id="thumbnail56" class="layerThumbnail"></canvas>
              56</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem57" href="#" onclick="setLayer(57);return false;">
              <canvas id="thumbnail57" class="layerThumbnail"></canvas>
              57</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem58" href="#" onclick="setLayer(58);return false;">
              <canvas id="thumbnail58" class="layerThumbnail"></canvas>
              58</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem59" href="#" onclick="setLayer(59);return false;">
              <canvas id="thumbnail59" class="layerThumbnail"></canvas>
              59</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem60" href="#" onclick="setLayer(60);return false;">
              <canvas id="thumbnail60" class="layerThumbnail"></canvas>
              60</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem61" href="#" onclick="setLayer(61);return false;">
              <canvas id="thumbnail61" class="layerThumbnail"></canvas>
              61</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem62" href="#" onclick="setLayer(62);return false;">
              <canvas id="thumbnail62" class="layerThumbnail"></canvas>
              62</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem63" href="#" onclick="setLayer(63);return false;">
              <canvas id="thumbnail63" class="layerThumbnail"></canvas>
              63</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem64" href="#" onclick="setLayer(64);return false;">
              <canvas id="thumbnail64" class="layerThumbnail"></canvas>
              64</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem65" href="#" onclick="setLayer(65);return false;">
              <canvas id="thumbnail65" class="layerThumbnail"></canvas>
              65</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem66" href="#" onclick="setLayer(66);return false;">
              <canvas id="thumbnail66" class="layerThumbnail"></canvas>
              66</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem67" href="#" onclick="setLayer(67);return false;">
              <canvas id="thumbnail67" class="layerThumbnail"></canvas>
              67</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem68" href="#" onclick="setLayer(68);return false;">
              <canvas id="thumbnail68" class="layerThumbnail"></canvas>
              68</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem69" href="#" onclick="setLayer(69);return false;">
              <canvas id="thumbnail69" class="layerThumbnail"></canvas>
              69</a>
            </li>
            
            <li> 
              <a class="layerItem" id="layerItem70" href="#" onclick="setLayer(70);return false;">
              <canvas id="thumbnail70" class="layerThumbnail"></canvas>
              70</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem71" href="#" onclick="setLayer(71);return false;">
              <canvas id="thumbnail71" class="layerThumbnail"></canvas>
              71</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem72" href="#" onclick="setLayer(72);return false;">
              <canvas id="thumbnail72" class="layerThumbnail"></canvas>
              72</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem73" href="#" onclick="setLayer(73);return false;">
              <canvas id="thumbnail73" class="layerThumbnail"></canvas>
              73</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem74" href="#" onclick="setLayer(74);return false;">
              <canvas id="thumbnail74" class="layerThumbnail"></canvas>
              74</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem75" href="#" onclick="setLayer(75);return false;">
              <canvas id="thumbnail75" class="layerThumbnail"></canvas>
              75</a>
            </li>

          </ul>
        </td>

        <td>          
          <ul>
            <li> 
              <a class="layerItem" id="layerItem76" href="#" onclick="setLayer(76);return false;">
              <canvas id="thumbnail76" class="layerThumbnail"></canvas>
              76</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem77" href="#" onclick="setLayer(77);return false;">
              <canvas id="thumbnail77" class="layerThumbnail"></canvas>
              77</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem78" href="#" onclick="setLayer(78);return false;">
              <canvas id="thumbnail78" class="layerThumbnail"></canvas>
              78</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem79" href="#" onclick="setLayer(79);return false;">
              <canvas id="thumbnail79" class="layerThumbnail"></canvas>
              79</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem80" href="#" onclick="setLayer(80);return false;">
              <canvas id="thumbnail80" class="layerThumbnail"></canvas>
              80</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem81" href="#" onclick="setLayer(81);return false;">
              <canvas id="thumbnail81" class="layerThumbnail"></canvas>
              81</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem82" href="#" onclick="setLayer(82);return false;">
              <canvas id="thumbnail82" class="layerThumbnail"></canvas>
              82</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem83" href="#" onclick="setLayer(83);return false;">
              <canvas id="thumbnail83" class="layerThumbnail"></canvas>
              83</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem84" href="#" onclick="setLayer(84);return false;">
              <canvas id="thumbnail84" class="layerThumbnail"></canvas>
              84</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem85" href="#" onclick="setLayer(85);return false;">
              <canvas id="thumbnail85" class="layerThumbnail"></canvas>
              85</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem86" href="#" onclick="setLayer(86);return false;">
              <canvas id="thumbnail86" class="layerThumbnail"></canvas>
              86</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem87" href="#" onclick="setLayer(87);return false;">
              <canvas id="thumbnail87" class="layerThumbnail"></canvas>
              87</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem88" href="#" onclick="setLayer(88);return false;">
              <canvas id="thumbnail88" class="layerThumbnail"></canvas>
              88</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem89" href="#" onclick="setLayer(89);return false;">
              <canvas id="thumbnail89" class="layerThumbnail"></canvas>
              89</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem90" href="#" onclick="setLayer(90);return false;">
              <canvas id="thumbnail90" class="layerThumbnail"></canvas>
              90</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem91" href="#" onclick="setLayer(92);return false;">
              <canvas id="thumbnail91" class="layerThumbnail"></canvas>
              91</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem92" href="#" onclick="setLayer(92);return false;">
              <canvas id="thumbnail92" class="layerThumbnail"></canvas>
              92</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem93" href="#" onclick="setLayer(93);return false;">
              <canvas id="thumbnail93" class="layerThumbnail"></canvas>
              93</a>
            </li>
            <li> 
              <a class="layerItem" id="layerItem94" href="#" onclick="setLayer(94);return false;">
              <canvas id="thumbnail94" class="layerThumbnail"></canvas>
              94</a>
            </li>
            
            <li> 
              <a class="layerItem" id="layerItem95" href="#" onclick="setLayer(95);return false;">
              <canvas id="thumbnail95" class="layerThumbnail"></canvas>
              95</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem96" href="#" onclick="setLayer(96);return false;">
              <canvas id="thumbnail96" class="layerThumbnail"></canvas>
              96</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem97" href="#" onclick="setLayer(97);return false;">
              <canvas id="thumbnail97" class="layerThumbnail"></canvas>
              97</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem98" href="#" onclick="setLayer(98);return false;">
              <canvas id="thumbnail98" class="layerThumbnail"></canvas>
              98</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem99" href="#" onclick="setLayer(99);return false;">
              <canvas id="thumbnail99" class="layerThumbnail"></canvas>
              99</a>
            </li>

            
            <li> 
              <a class="layerItem" id="layerItem100" href="#" onclick="setLayer(100);return false;">
              <canvas id="thumbnail100" class="layerThumbnail"></canvas>
              100</a>
            </li>

          </ul>
        </td>


        <td valign="top">
          <table>
            <tr>
              <td>
                <table>
                  <tr>
                    <td>
                      <center>
                        <input width="800" style="border:2px solid gray;" onkeydown="event.stopPropagation();" value="www.flickgame.org"  id="linkInput" oninput="linkChange(this.value)" />
                        <br/>
                        <canvas id="mainCanvas" width="800" height="400" style="border:2px solid gray; background-color:black;"></canvas>
                        <br />
                        <table id="underTable" margin="0">


                          <tr height="16">
                            <td>
                             <a href="#" onclick="setColor(0);return false;">
                              <div  class=
                              "unselected" id="color_0"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_0" name="textarea_0"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(1);return false;">
                              <div class=
                              "unselected" id="color_1"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_1" name="textarea_1"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(2);return false;">
                              <div  class=
                              "selected" id="color_2"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_2" name="textarea_2"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(3);return false;">
                              <div class=
                              "unselected" id="color_3"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_3" name="textarea_3"></textarea>
                            </td>                                              
                          </tr>
                          

                          <tr height="16">
                            <td>
                             <a href="#" onclick="setColor(4);return false;">
                              <div  class=
                              "unselected" id="color_4"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_4" name="textarea_4"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(5);return false;">
                              <div class=
                              "unselected" id="color_5"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_5" name="textarea_5"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(6);return false;">
                              <div  class=
                              "unselected" id="color_6"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_6" name="textarea_6"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(7);return false;">
                              <div class=
                              "unselected" id="color_7"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_7" name="textarea_7"></textarea>
                            </td>                                              
                          </tr>

                          

                          <tr height="16">
                            <td>
                             <a href="#" onclick="setColor(8);return false;">
                              <div  class=
                              "unselected" id="color_8"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_8" name="textarea_8"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(9);return false;">
                              <div class=
                              "unselected" id="color_9"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_9" name="textarea_9"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(10);return false;">
                              <div  class=
                              "unselected" id="color_10"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_10" name="textarea_10"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(11);return false;">
                              <div class=
                              "unselected" id="color_11"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_11" name="textarea_11"></textarea>
                            </td>                                              
                          </tr>

                          

                          <tr height="16">
                            <td>
                             <a href="#" onclick="setColor(12);return false;">
                              <div  class=
                              "unselected" id="color_12"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_12" name="textarea_12"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(13);return false;">
                              <div class=
                              "unselected" id="color_13"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_13" name="textarea_13"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(14);return false;">
                              <div  class=
                              "unselected" id="color_14"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_14" name="textarea_14"></textarea>
                            </td>

                            <td>
                             <a href="#" onclick="setColor(15);return false;">
                              <div class=
                              "unselected" id="color_15"></div></a>
                            </td>

                            <td>
                              <textarea id="textarea_15" name="textarea_15"></textarea>
                            </td>                                              
                          </tr>
                          

                        </table>
                      </center>
                    </td>
                    <td valign="top">
                      <a href="#" onclick="shareClick();return false;">&ocir; share</a><br />
                      <div id="shareLink"></div>
                      <a href="#" onclick="exportClick();return false;">&sdotb; export</a><br />
                      <a href="#" onclick="document.getElementById('my_file').click();return false;">&sdotb; import</a><br />
                      <input type="file" accept=".html" id="my_file" style="display: none;" />
                      <a href="help.html" target="_blank" title="blah">? help</a>
                      <br />
                      <br />
                      <a href="#" onclick="setRadius(16);return false;"><img src="16.png" class="radius" id="radius_16" /></a>
                      <br />
                      <a href="#" onclick="setRadius(13);return false;"><img src="13.png" class="radius" id="radius_13" /></a>
                      <br />
                      <a href="#" onclick="setRadius(11);return false;"><img src="11.png" class="radius" id="radius_11" /></a>
                      <br />
                      <a href="#" onclick="setRadius(9);return false;"><img src="9.png" class="radius" id="radius_9" /></a>
                      <br />
                      <a href="#" onclick="setRadius(7);return false;"><img src="7.png" class="radius" id="radius_7" /></a>
                      <br />
                      <a href="#" onclick="setRadius(5);return false;"><img src="5.png" class="radius selected" id="radius_5" /></a>
                      <br />
                      <a href="#" onclick="setRadius(3);return false;"><img src="3.png" class="radius" id="radius_3" /></a>
                      <br />
                      <a href="#" onclick="setRadius(1);return false;"><img src="1.png" class="radius" id="radius_1" /></a>
                      <br />
                      <a href="#" onclick="setRadius(0);return false;"><img src="bucket.png" class="radius" id="bucket"/></a>
                      <br />
                      <a href="#" onclick="clearPalette();return false;"><img src="clear.png" class="radius" id="bucket"/></a>
                    </td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
        </td>
      </tr>
    </table>
    </center>
  </body>
</html>